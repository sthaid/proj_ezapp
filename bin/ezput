#!/bin/bash

# verify parent directory is 'apps'
parent_dir=$(basename $(dirname $PWD))
if [ "$parent_dir" != apps -a "$parent_dir" != svcs ]; then
    echo "ERROR: parent_dir must be apps or svcs"
    exit 1
fi

# if no args provided then 
#   set filename_list to all files in this directory, 
#   plus layout file when in subdir of apps, or svcs when in subdir svcs
# else
#   else the filename_list are the args
# endif
if [ "$1" = "" ]; then
  filename_list="*"
  if [ "$parent_dir" = apps ]; then
    filename_list="$filename_list ../layout"
  fi
  if [ "$parent_dir" = svcs ]; then
    filename_list="$filename_list ../svcs"
  fi
else
  filename_list="$*"
fi

# determine the destination dir (on android), and whether it exists
this_dir="$(basename $PWD)"
if [ "$parent_dir" = apps ]; then
  android_dir="apps/$this_dir"
else
  android_dir="svcs/$this_dir"
fi
android_dir_exists=$(ezsh "if [ ! -d $android_dir ]; then echo NO; else echo YES; fi")

# if invalid response received then ezApp may not be running or developer mode not entabled,
# or invalid password
if [ "$android_dir_exists" != NO -a "$android_dir_exists" != YES ]; then
  echo $android_dir_exists
  echo "ERROR: ezput failed"
  exit 1
fi

# if the android_dir does not exist then prompt user to create it
if [ "$android_dir_exists" != YES ]; then
  echo "ERROR: android dir $android_dir does not exist"
  read -p "Create y/n? " yn
  if [ "$yn" != y ]; then
    exit 1
  fi
  ezsh "mkdir $android_dir"
fi

# loop over filename_list
for filename in $filename_list; do
  # copy the file to Android
  echo "copying to android $android_dir/$filename"
  ezsh "put $filename $android_dir/$filename"
done

exit 0
